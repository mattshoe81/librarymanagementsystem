@model LibraryWebUI.ViewModels.Member.BrowseViewModel
@using CoreLibrary.Inventory
@using LibraryWebUI.ViewModels.Member
@using LibraryWebUI.Models
@{
	ViewData["Title"] = "BrowseInventory";
	Layout = "~/Views/Shared/_MemberLayout.cshtml";
}

<hr />

<div class="form-inline">
	<div class="row">
		<div class="col-xs-3">
			<form asp-action="SortSearch" method="post">
				<label for="sortSearchBy">Sort By:</label>
				<div class="form-inline">
					<select name="sortSearchBy" class="form-control form-control-sm">
						<option value="title">Title</option>
						<option value="author">Author</option>
						<option value="genre">Genre</option>
						<option value="format">Format</option>
						<option value="libraryID">Library ID</option>
					</select>
					<input type="submit" value="Sort" class="btn btn-toolbar text-center" />
				</div>
			</form>
		</div>
		<div class="col-xs-6 pull-left">
			<form asp-action="SearchByUserString" method="post">
				<label for="searchString">Search:</label>
				<div class="form-inline">
					<input type="text" size="50" name="searchString" class="form-control form-control-sm" />
					<input type="submit" value="Search" class="btn btn-toolbar text-center" />
				</div>
			</form>
		</div>
		<div class="col-xs-3 pull-left">
			<form asp-action="SetResultsPerPage" method="post">
				<label asp-for="@BrowseViewModel.ResultsPerPage">Results Per Page: </label>
				<div class="form-inline">
					<select style="font-size:130%;" asp-for="@BrowseViewModel.ResultsPerPage" name="resultsPerPage">
						<option value="5">5</option>
						<option value="10">10</option>
						<option value="15">15</option>
						<option value="25">25</option>
						<option value="50">50</option>
						<option value="100">100</option>
					</select>
					<input style="margin-left:10px;" type="submit" value="Update" class="btn btn-toolbar text-center" />
				</div>
				
			</form>
		</div>
	</div>
</div>


<div>

	<ul class="pager" style="margin-left:10%; margin-right:10%;">
		@if (BrowseViewModel.CurrentPage > 1) {
			<li class="previous">
				@Html.ActionLink("Previous", "PreviousPage")
			</li>
		}
		@if (BrowseViewModel.CurrentPage <= (int) (SearchRepository.ResultsCount / BrowseViewModel.ResultsPerPage)) {
			<li class="next">
				@Html.ActionLink("Next", "NextPage")
			</li>
		}
	</ul>
	<hr style="border-top: 1px solid; margin-top:0; margin-bottom:50px;" />
	@{
		IEnumerable<IBook> results = Model.Books.Skip((BrowseViewModel.CurrentPage - 1) * BrowseViewModel.ResultsPerPage).Take(BrowseViewModel.ResultsPerPage).ToList();
		foreach (IBook book in results) {
			<div class="row">

				<div class="col-xs-2">
					<a href="@Url.Action("BookDetails", new { libraryID=@book.LibraryID })">
						<img src="@($"data:image/png;base64,{Convert.ToBase64String(book.ImageBytes)}")" class="img-responsive center-block">
					</a>
					<p style="margin-top:10px;" class="text-center">
						<span style="font-weight:bold;">Format: </span> <em>@book.Format</em> <br />
					</p>
				</div>

				<div class="col-xs-10">
					<form asp-action="BookDetails" method="post">
						<input hidden type="number" name="libraryID" value="@book.LibraryID" />
						<input style="white-space:normal; text-align:left; margin-left:0; padding:0; font-size:180%; color:#000000; width:90%; font-style:italic; line-height:1.125;"
							   type="submit"
							   class="btn btn-link"
							   value="@book.Title" />
					</form>
					<h5 style="margin-top:0;"><span style="font-weight:bold;">By: </span> <em>@book.Author</em></h5>
					<div class="row">
						<div class="col-xs-11">
							<h6>
								<span style="font-weight:bold;">Length: </span> <em>@book.Length pages</em> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
								<span style="font-weight:bold;">Genre: </span> <em>@book.Genre</em>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
								<span style="font-weight:bold;">ID#: </span> <em>@book.LibraryID</em>
							</h6>
							<textarea readonly style="width:100%; overflow:hidden; padding:0; margin-bottom:0; border:none; resize:none;" rows="4">@book.Description</textarea>
							<div>
								<form style="display:inline-block;" asp-action="BookDetails" method="post">
									<input hidden type="number" name="libraryID" value="@book.LibraryID" />
									<input style="font-size:95%; color:#000000; width:100%; font-style:italic; line-height:1.125; margin:0; padding:0;"
										   type="submit"
										   class="btn btn-link"
										   value="Read More" />
								</form>

								@if (LibraryWebUI.Models.AccountRepository.LoggedInAccount != null && book.InStock) {
									if (LibraryWebUI.Models.Cart.CartContents.Contains(book)) {
										<form style="display:inline-block; margin-top:3%; margin-right:5%;" class="pull-right" asp-action="AddToCart" method="post">
											<input hidden type="number" name="libraryID" value="@book.LibraryID" />
											<input type="submit" disabled class="btn btn-success" value="Already In Cart!" />
										</form>
									} else {
										<form style="display:inline-block; margin-top:3%; margin-right:5%;" class="pull-right" asp-action="AddToCart" method="post">
											<input hidden type="number" name="libraryID" value="@book.LibraryID" />
											<input type="submit" class="btn btn-success" value="Reserve Now!" />
										</form>
									}

								} else {
									if (book.InStock) {
										<p style="display:inline-block; margin-top:3%; margin-right:5%;" class="pull-right">
											In Stock!
										</p>
									} else {
										<p style="display:inline-block; margin-top:3%; margin-right:5%;" class="pull-right">
											Not In Stock!
										</p>

									}

								}
							</div>

						</div>

					</div>
				</div>
			</div>
			<hr style="border-top: 1px solid; margin-top: 50px; margin-bottom:50px;" />
		}
	}

	<hr />

	<ul class="pager">
		@if (BrowseViewModel.CurrentPage > 1) {
			<li class="previous">
				@Html.ActionLink("Previous", "PreviousPage");
			</li>
		}
		@if (BrowseViewModel.CurrentPage <= (int) (SearchRepository.ResultsCount / BrowseViewModel.ResultsPerPage)) {
			<li class="next">
				@Html.ActionLink("Next", "NextPage");
			</li>
		}
	</ul>




</div>
